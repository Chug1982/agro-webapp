<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û–±—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è ‚Äî –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–ô –ö–õ–Æ–ß -->
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=–í–ê–®_YANDEX_API_KEY" type="text/javascript"></script>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
    #done-btn {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: white;
      border: 1px solid #ccc;
      font-size: 16px;
      z-index: 1000;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="done-btn">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</div>
  <div id="map"></div>

  <script>
    ymaps.ready(init);
    let myPolygon;

    function init() {
      const map = new ymaps.Map("map", {
        center: [55.7558, 37.6173], // –¶–µ–Ω—Ç—Ä –ú–æ—Å–∫–≤–∞
        zoom: 11,
        type: 'yandex#hybrid',
        controls: ['zoomControl']
      });

      map.behaviors.enable('default');

      // –ì–æ–≤–æ—Ä–∏–º Telegram, —á—Ç–æ WebApp –≥–æ—Ç–æ–≤
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();
      }

      myPolygon = new ymaps.Polygon([], {}, {
        editorDrawingCursor: "crosshair",
        fillColor: '#00FF0088',
        strokeColor: "#0000FF",
        strokeWidth: 3,
        opacity: 0.5
      });

      map.geoObjects.add(myPolygon);
      myPolygon.editor.startDrawing();

      document.getElementById('done-btn').onclick = function () {
        const coords = myPolygon.geometry.getCoordinates()[0];
        if (!coords.length) {
          alert("–°–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∏—Å—É–π—Ç–µ –ø–æ–ª–µ!");
          return;
        }

        const geojson = {
          type: "Feature",
          geometry: {
            type: "Polygon",
            coordinates: [coords]
          },
          properties: {}
        };

        const jsonStr = JSON.stringify(geojson);
        console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ GeoJSON:", jsonStr);

        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.sendData(jsonStr);
          Telegram.WebApp.close();
        } else {
          alert("GeoJSON:\\n" + jsonStr);
        }
      };
    }
  </script>
</body>
</html>
